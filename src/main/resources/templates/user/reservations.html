<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moje Rezerwacje - RentACar</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
    <header th:replace="fragments/header :: header"></header>
    
    <main class="container py-5">
        <div th:if="${message}" class="alert alert-success" th:text="${message}"></div>
        <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>
        
        <h1 class="mb-4">Moje Rezerwacje</h1>
        
        <ul class="nav nav-tabs mb-4">
            <li class="nav-item">
                <a class="nav-link active" href="#upcoming" data-bs-toggle="tab">Nadchodzące</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#past" data-bs-toggle="tab">Przeszłe</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#canceled" data-bs-toggle="tab">Anulowane</a>
            </li>
        </ul>
        
        <div class="tab-content">
            <div class="tab-pane fade show active" id="upcoming">
                <div class="row">
                    <div th:each="reservation : ${reservations}" class="col-md-6 mb-4"
                         th:if="${reservation.status.name() != 'CANCELED' && reservation.status.name() != 'COMPLETED'}">
                        <div class="card h-100 shadow-sm">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">Rezerwacja #<span th:text="${reservation.id}"></span></h5>
                                <span class="badge bg-info" th:text="${reservation.status}"></span>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-4">
                                        <img th:if="${reservation.vehicle.imageUrl}" th:src="${reservation.vehicle.imageUrl}" 
                                             class="img-fluid rounded" alt="Zdjęcie pojazdu">
                                        <div th:unless="${reservation.vehicle.imageUrl}" 
                                             class="bg-secondary text-white d-flex align-items-center justify-content-center rounded" 
                                             style="height: 100px;">
                                            <span>Brak zdjęcia</span>
                                        </div>
                                    </div>
                                    <div class="col-md-8">
                                        <h5 th:text="${reservation.vehicle.brand + ' ' + reservation.vehicle.model}"></h5>
                                        <p class="mb-2">
                                            <span class="badge bg-info" th:text="${reservation.vehicle.type}"></span>
                                            <span th:text="${reservation.vehicle.year}"></span>
                                        </p>
                                        <p class="mb-1">
                                            <i class="bi bi-calendar3 me-2"></i>
                                            <span th:text="${#temporals.format(reservation.startDate, 'yyyy-MM-dd HH:mm')}"></span>
                                        </p>
                                        <p class="mb-1">
                                            <i class="bi bi-calendar3-event me-2"></i>
                                            <span th:text="${#temporals.format(reservation.endDate, 'yyyy-MM-dd HH:mm')}"></span>
                                        </p>
                                        <p class="mb-0 fw-bold text-primary" th:text="${'Razem: ' + reservation.totalCost + ' zł'}"></p>
                                    </div>
                                </div>
                            </div>
                            <div class="card-footer bg-white">
                                <div class="d-flex justify-content-between">
                                    <a th:href="@{/reservations/details/{id}(id=${reservation.id})}" class="btn btn-outline-primary btn-sm">
                                        Zobacz szczegóły
                                    </a>
                                    <form th:action="@{/reservations/cancel/{id}(id=${reservation.id})}" method="post">
                                        <button type="submit" class="btn btn-outline-danger btn-sm" 
                                                onclick="return confirm('Czy na pewno chcesz anulować tę rezerwację?');">
                                            Anuluj rezerwację
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-12" th:if="${#lists.isEmpty(reservations) || 
                                               !#arrays.contains(reservations.![status.name()], 'CONFIRMED') && 
                                               !#arrays.contains(reservations.![status.name()], 'PENDING')}">
                        <div class="alert alert-info text-center">
                            <i class="bi bi-calendar-x fs-2 mb-3"></i>
                            <h5>Brak nadchodzących rezerwacji</h5>
                            <p>Nie masz żadnych nadchodzących rezerwacji.</p>
                            <a href="/vehicles" class="btn btn-primary mt-2">Przeglądaj pojazdy</a>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="tab-pane fade" id="past">
                <div class="row">
                    <div th:each="reservation : ${reservations}" class="col-md-6 mb-4"
                         th:if="${reservation.status.name() == 'COMPLETED'}">
                        <div class="card h-100 shadow-sm">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">Reservation #<span th:text="${reservation.id}"></span></h5>
                                <span class="badge bg-info" th:text="${reservation.status}"></span>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-4">
                                        <img th:if="${reservation.vehicle.imageUrl}" th:src="${reservation.vehicle.imageUrl}" 
                                             class="img-fluid rounded" alt="Vehicle Image">
                                        <div th:unless="${reservation.vehicle.imageUrl}" 
                                             class="bg-secondary text-white d-flex align-items-center justify-content-center rounded" 
                                             style="height: 100px;">
                                            <span>No Image</span>
                                        </div>
                                    </div>
                                    <div class="col-md-8">
                                        <h5 th:text="${reservation.vehicle.brand + ' ' + reservation.vehicle.model}"></h5>
                                        <p class="mb-2">
                                            <span class="badge bg-info" th:text="${reservation.vehicle.type}"></span>
                                            <span th:text="${reservation.vehicle.year}"></span>
                                        </p>
                                        <p class="mb-1">
                                            <i class="bi bi-calendar3 me-2"></i>
                                            <span th:text="${#temporals.format(reservation.startDate, 'yyyy-MM-dd HH:mm')}"></span>
                                        </p>
                                        <p class="mb-1">
                                            <i class="bi bi-calendar3-event me-2"></i>
                                            <span th:text="${#temporals.format(reservation.endDate, 'yyyy-MM-dd HH:mm')}"></span>
                                        </p>
                                        <p class="mb-0 fw-bold text-primary" th:text="${'Total: $' + reservation.totalCost}"></p>
                                    </div>
                                </div>
                                
                                <div th:if="${reservation.rating != null}" class="mt-3">
                                    <div class="d-flex align-items-center">
                                        <span class="me-2">Your Rating:</span>
                                        <span class="text-warning">
                                            <i class="bi bi-star-fill" th:each="i : ${#numbers.sequence(1, reservation.rating)}"></i>
                                            <i class="bi bi-star" th:each="i : ${#numbers.sequence(reservation.rating + 1, 5)}"></i>
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div class="card-footer bg-white">
                                <a th:href="@{/reservations/details/{id}(id=${reservation.id})}" class="btn btn-outline-primary btn-sm">
                                    View Details
                                </a>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-12" th:if="${#lists.isEmpty(reservations) || 
                                               !#arrays.contains(reservations.![status.name()], 'COMPLETED')}">
                        <div class="alert alert-info text-center">
                            <i class="bi bi-calendar-check fs-2 mb-3"></i>
                            <h5>Brak przeszłych rezerwacji</h5>
                            <p>Nie masz jeszcze zakończonych rezerwacji.</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="tab-pane fade" id="canceled">
                <div class="row">
                    <div th:each="reservation : ${reservations}" class="col-md-6 mb-4"
                         th:if="${reservation.status.name() == 'CANCELED'}">
                        <div class="card h-100 shadow-sm">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">Reservation #<span th:text="${reservation.id}"></span></h5>
                                <span class="badge bg-info" th:text="${reservation.status}"></span>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-4">
                                        <img th:if="${reservation.vehicle.imageUrl}" th:src="${reservation.vehicle.imageUrl}" 
                                             class="img-fluid rounded" alt="Vehicle Image">
                                        <div th:unless="${reservation.vehicle.imageUrl}" 
                                             class="bg-secondary text-white d-flex align-items-center justify-content-center rounded" 
                                             style="height: 100px;">
                                            <span>No Image</span>
                                        </div>
                                    </div>
                                    <div class="col-md-8">
                                        <h5 th:text="${reservation.vehicle.brand + ' ' + reservation.vehicle.model}"></h5>
                                        <p class="mb-2">
                                            <span class="badge bg-info" th:text="${reservation.vehicle.type}"></span>
                                            <span th:text="${reservation.vehicle.year}"></span>
                                        </p>
                                        <p class="mb-1">
                                            <i class="bi bi-calendar3 me-2"></i>
                                            <span th:text="${#temporals.format(reservation.startDate, 'yyyy-MM-dd HH:mm')}"></span>
                                        </p>
                                        <p class="mb-1">
                                            <i class="bi bi-calendar3-event me-2"></i>
                                            <span th:text="${#temporals.format(reservation.endDate, 'yyyy-MM-dd HH:mm')}"></span>
                                        </p>
                                        <p class="mb-0 fw-bold text-primary" th:text="${'Total: $' + reservation.totalCost}"></p>
                                    </div>
                                </div>
                            </div>
                            <div class="card-footer bg-white">
                                <a th:href="@{/reservations/details/{id}(id=${reservation.id})}" class="btn btn-outline-primary btn-sm">
                                    View Details
                                </a>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-12" th:if="${#lists.isEmpty(reservations) || 
                                               !#arrays.contains(reservations.![status.name()], 'CANCELED')}">
                        <div class="alert alert-info text-center">
                            <i class="bi bi-calendar-x fs-2 mb-3"></i>
                            <h5>Brak anulowanych rezerwacji</h5>
                            <p>Nie masz żadnych anulowanych rezerwacji.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <footer th:replace="fragments/footer :: footer"></footer>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
